<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>شمارشگر پول</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font for better Persian display */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            direction: rtl; /* Set text direction to right-to-left for Persian */
        }
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"] {
            -moz-appearance: textfield;
        }
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #3b82f6; /* Blue-500 */
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-right: 8px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-100 to-purple-200 min-h-screen flex items-center justify-center p-4">
    <div class="bg-white rounded-xl shadow-2xl p-8 w-full max-w-md transform transition-all duration-300 hover:scale-105">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-8">شمارشگر پول</h1>

        <div class="space-y-6">
            <div class="flex items-center justify-between bg-purple-50 p-4 rounded-lg shadow-sm">
                <label for="note200000" class="text-lg font-medium text-gray-700 w-1/2">تعداد اسکناس ۲۰۰,۰۰۰ تومانی:</label>
                <input type="number" id="note200000" min="0" value="0"
                       class="w-1/2 p-2 border border-purple-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 text-center text-lg font-semibold text-gray-800">
            </div>

            <div class="flex items-center justify-between bg-blue-50 p-4 rounded-lg shadow-sm">
                <label for="note100000" class="text-lg font-medium text-gray-700 w-1/2">تعداد اسکناس ۱۰۰,۰۰۰ تومانی:</label>
                <input type="number" id="note100000" min="0" value="0"
                       class="w-1/2 p-2 border border-blue-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-center text-lg font-semibold text-gray-800">
            </div>

            <div class="flex items-center justify-between bg-green-50 p-4 rounded-lg shadow-sm">
                <label for="note50000" class="text-lg font-medium text-gray-700 w-1/2">تعداد اسکناس ۵۰,۰۰۰ تومانی:</label>
                <input type="number" id="note50000" min="0" value="0"
                       class="w-1/2 p-2 border border-green-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 text-center text-lg font-semibold text-gray-800">
            </div>

            <div class="flex items-center justify-between bg-yellow-50 p-4 rounded-lg shadow-sm">
                <label for="note10000" class="text-lg font-medium text-gray-700 w-1/2">تعداد اسکناس ۱۰,۰۰۰ تومانی:</label>
                <input type="number" id="note10000" min="0" value="0"
                       class="w-1/2 p-2 border border-yellow-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500 text-center text-lg font-semibold text-gray-800">
            </div>
        </div>

        <div class="mt-8 text-center bg-gray-100 p-6 rounded-lg shadow-md">
            <p class="text-xl font-semibold text-gray-700">مجموع کل:</p>
            <p id="totalAmount" class="text-4xl font-extrabold text-blue-600 mt-2">۰ تومان</p>
        </div>

        <div class="mt-8 space-y-4">
            <button id="whatToBuyButton"
                    class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg
                           transform transition-transform duration-200 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-opacity-75 flex items-center justify-center">
                <span class="text-xl mr-2">✨</span> پیشنهاد خرید
            </button>
            <button id="moneyFactButton"
                    class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg
                           transform transition-transform duration-200 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-green-400 focus:ring-opacity-75 flex items-center justify-center">
                <span class="text-xl mr-2">✨</span> حقیقت جالب پول
            </button>
        </div>

        <div id="llmResponseContainer" class="mt-8 bg-indigo-50 p-6 rounded-lg shadow-md hidden">
            <p class="text-lg font-semibold text-indigo-800 mb-2">پاسخ هوش مصنوعی:</p>
            <div id="llmResponse" class="text-gray-700 leading-relaxed"></div>
            <div id="llmLoading" class="hidden text-center mt-4">
                <div class="loading-spinner"></div>
                <span class="text-blue-600 font-medium">در حال دریافت پاسخ...</span>
            </div>
        </div>

        <div class="mt-8 text-center">
            <button id="clearButton"
                    class="bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg
                           transform transition-transform duration-200 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-red-400 focus:ring-opacity-75">
                پاک کردن
            </button>
        </div>
    </div>

    <script>
        // Get references to input fields and total display element
        const note200000Input = document.getElementById('note200000');
        const note100000Input = document.getElementById('note100000');
        const note50000Input = document.getElementById('note50000');
        const note10000Input = document.getElementById('note10000');
        const totalAmountDisplay = document.getElementById('totalAmount');
        const clearButton = document.getElementById('clearButton');
        const whatToBuyButton = document.getElementById('whatToBuyButton');
        const moneyFactButton = document.getElementById('moneyFactButton');
        const llmResponseContainer = document.getElementById('llmResponseContainer');
        const llmResponseDisplay = document.getElementById('llmResponse');
        const llmLoading = document.getElementById('llmLoading');

        // Initialize Firebase (even if not using Firestore, good practice if provided)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // Firebase initialization is not strictly needed for this app as no persistence is used,
        // but including the boilerplate as per instructions.
        // import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        // import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        // let app, auth;
        // if (Object.keys(firebaseConfig).length > 0) {
        //     app = initializeApp(firebaseConfig);
        //     auth = getAuth(app);
        //     if (initialAuthToken) {
        //         signInWithCustomToken(auth, initialAuthToken).catch(console.error);
        //     } else {
        //         signInAnonymously(auth).catch(console.error);
        //     }
        // }


        /**
         * Calculates the total amount based on the number of notes entered.
         * @returns {number} The total amount in Tomans.
         */
        function calculateTotal() {
            const count200000 = parseInt(note200000Input.value) || 0;
            const count100000 = parseInt(note100000Input.value) || 0;
            const count50000 = parseInt(note50000Input.value) || 0;
            const count10000 = parseInt(note10000Input.value) || 0;

            const total = (count200000 * 200000) +
                          (count100000 * 100000) +
                          (count50000 * 50000) +
                          (count10000 * 10000);

            // Format the total with commas for better readability
            totalAmountDisplay.textContent = total.toLocaleString('fa-IR') + ' تومان';
            return total;
        }

        /**
         * Clears all input fields and resets the total amount.
         */
        function clearInputs() {
            note200000Input.value = 0;
            note100000Input.value = 0;
            note50000Input.value = 0;
            note10000Input.value = 0;
            calculateTotal(); // Recalculate total after clearing
            llmResponseContainer.classList.add('hidden'); // Hide LLM response
            llmResponseDisplay.textContent = ''; // Clear LLM response text
        }

        /**
         * Calls the Gemini API to get a text response.
         * @param {string} prompt The prompt to send to the LLM.
         * @returns {Promise<string>} The text response from the LLM.
         */
        async function getGeminiResponse(prompt) {
            llmResponseContainer.classList.remove('hidden');
            llmResponseDisplay.textContent = '';
            llmLoading.classList.remove('hidden');

            try {
                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                const apiKey = ""; // Canvas will provide this at runtime if empty
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    return text;
                } else {
                    console.error("Unexpected LLM response structure:", result);
                    return "خطا در دریافت پاسخ از هوش مصنوعی. لطفاً دوباره تلاش کنید.";
                }
            } catch (error) {
                console.error("Error calling Gemini API:", error);
                return "خطا در برقراری ارتباط با هوش مصنوعی. لطفاً اتصال اینترنت خود را بررسی کنید.";
            } finally {
                llmLoading.classList.add('hidden');
            }
        }

        /**
         * Handles the "What can I buy?" button click.
         */
        async function handleWhatToBuy() {
            const total = calculateTotal();
            const prompt = `Given that I have ${total.toLocaleString('fa-IR')} Iranian Tomans, suggest 3-5 practical and common items or services I could purchase with this amount in Iran. Keep the suggestions concise and realistic for this value. Respond in Persian.`;
            const response = await getGeminiResponse(prompt);
            llmResponseDisplay.textContent = response;
        }

        /**
         * Handles the "Money Fact" button click.
         */
        async function handleMoneyFact() {
            const total = calculateTotal();
            const prompt = `Provide an interesting and concise fact about money, currency, or economics, preferably related to the value of ${total.toLocaleString('fa-IR')} Iranian Tomans if possible, or a general fact if specific relation is hard. Respond in Persian.`;
            const response = await getGeminiResponse(prompt);
            llmResponseDisplay.textContent = response;
        }


        // Add event listeners to all input fields to recalculate total on change
        note200000Input.addEventListener('input', calculateTotal);
        note100000Input.addEventListener('input', calculateTotal);
        note50000Input.addEventListener('input', calculateTotal);
        note10000Input.addEventListener('input', calculateTotal);

        // Add event listener to the clear button
        clearButton.addEventListener('click', clearInputs);

        // Add event listeners for LLM buttons
        whatToBuyButton.addEventListener('click', handleWhatToBuy);
        moneyFactButton.addEventListener('click', handleMoneyFact);

        // Initial calculation when the page loads
        document.addEventListener('DOMContentLoaded', calculateTotal);
    </script>
</body>
</html>
